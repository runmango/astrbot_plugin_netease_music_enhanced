# 网易云点歌增强版（AstrBot 插件）

在 [astrbot_plugin_neteasecloud_music](https://github.com/SatenShiroya/astrbot_plugin_neteasecloud_music) 基础上扩展的网易云点歌插件，仅适用于 **QQ 平台**（NapCat/QQNT 等）。

## 功能概览

- **自然语言点歌**：说歌名或「歌手 + 歌名」，在 QQ 中发送网易云音乐卡片。
- **换一首不重复**：用户说「换一首」「再来一首」时，从上一轮搜索列表中换一首播放，尽量不重复；列表播完会重新搜索再随机。
- **仅提歌手时随机**：当用户只提歌手未提歌名（如「放周杰伦的歌」「来首孙燕姿的」）时，从该歌手歌曲中**随机**选一首，并避免与最近播放重复。
- **不播报「已为您播放」**：默认不再发送「已为您播放《xxx》」类提示；可在配置中自定义回复模板，留空即不发送。
- **按网易云用户「喜欢」推送**：支持搜索网易云用户（昵称或用户 ID），播放该用户「我喜欢的音乐」中的歌曲；**推送顺序为先新后旧**（先推送最新喜欢的，再推送较旧的），同一会话多次调用会按顺序往后推。

## 安装与配置

- 在 AstrBot 插件市场中搜索 `astrbot_plugin_NetEase_Music_Enhanced` 安装，或本地压缩包安装。
- 配置项（与愿项目类似）：
  - **play_success_message_template**：点歌/换一首/用户喜欢 成功后的回复模板，支持 `{title}`、`{artist}`；**默认留空**，不提示「已为您播放」。
  - **proxy_url**：可选 HTTP/HTTPS/SOCKS 代理（海外建议配置）；使用 SOCKS 需安装 `pip install aiohttp-socks`。

## LLM 工具说明（给 AI 用）

1. **play_netease_song_by_name(song_name, only_artist=False)**  
   - 按歌名或歌手点歌。  
   - 若用户**只说了歌手**（如「放周杰伦的歌」）未说歌名，请传 `only_artist=True`，会从该歌手歌曲中随机一首且尽量不重复。  
   - 若用户说「换一首」「再来一首」等，应调用下面的 `change_netease_song`，不要用本工具。

2. **change_netease_song()**  
   - 无参数。用户说「换一首」「换一首歌」「再来一首」「换一个」等时调用。  
   - 从上一轮搜索列表里换一首播放（不重复）；上一轮列表播完后会重新搜索再随机一首。

3. **play_netease_user_liked_song(user_identifier)**  
   - 根据网易云用户（昵称或用户 ID）播放其「我喜欢的音乐」中的一首。  
   - 推送顺序：**先推送最新喜欢的，再推送较旧的**；同一会话多次调用会按该顺序依次推送。

## 使用示例

- 「我想听七里香」→ 按歌名点歌。  
- 「放周杰伦的歌」→ 只提歌手，随机一首周杰伦的歌（不重复）。  
- 「换一首」/「再来一首」→ 换一首（不重复）。  
- 「播放 xxx（网易云昵称）喜欢的歌」→ 按用户喜欢列表，先新后旧推送一首。

## 依赖与协议

- 依赖：`aiohttp`；使用 SOCKS 代理时需 `aiohttp-socks`。  
- 仅 QQ 平台会发送音乐卡片；其他平台会返回文字说明。  
- 网易云接口为网页端非官方接口，仅供学习交流，请勿滥用。

## 版本

- **V1.0.0**：首版，包含上述全部功能。
